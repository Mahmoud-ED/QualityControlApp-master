@model QualityControlApp.ViewModels.AirPortReqeustVM

@{
    ViewData["Title"] = "Create New Airport Request"; // Translated
}

<div class="card shadow-lg">
    <div class="card-header bg-primary text-white py-3">
        <h2 class="card-title mb-0 text-center">
            <i class="fas fa-plane-departure me-2"></i>@ViewData["Title"]
        </h2>
    </div>
    <div class="card-body p-4">
        <form asp-action="Create" method="post" enctype="multipart/form-data" class="needs-validation" novalidate>
            <div class="row g-3">
                <!-- Row 1 -->
                <div class="col-md-6">
                    <div class="form-floating">
                        <input asp-for="AirPortRequest.Department" class="form-control" placeholder=" " required />
                        <label asp-for="AirPortRequest.Department"></label>
                        <span asp-validation-for="AirPortRequest.Department" class="text-danger"></span>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="form-floating">
                        <input asp-for="AirPortRequest.Email" class="form-control" type="email" placeholder=" " required />
                        <label asp-for="AirPortRequest.Email"></label>
                        <span asp-validation-for="AirPortRequest.Email" class="text-danger"></span>
                    </div>
                </div>

                <!-- Row 2 -->

                <div class="col-md-6">
                    <div class="form-floating">
                        <input asp-for="AirPortRequest.EntryTime" class="form-control" type="datetime-local" placeholder=" " required />
                        <label asp-for="AirPortRequest.EntryTime"></label>
                        <span asp-validation-for="AirPortRequest.EntryTime" class="text-danger"></span>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="form-floating">
                        <input asp-for="AirPortRequest.FlightDate" class="form-control" type="date" placeholder=" " required />
                        <label asp-for="AirPortRequest.FlightDate"></label>
                        <span asp-validation-for="AirPortRequest.FlightDate" class="text-danger"></span>
                    </div>
                </div>

                <!-- Row 3 -->
                <div class="col-md-6">
                    <div class="form-floating">
                        <input asp-for="AirPortRequest.SenderName" class="form-control" placeholder=" " required />
                        <label asp-for="AirPortRequest.SenderName"></label>
                        <span asp-validation-for="AirPortRequest.SenderName" class="text-danger"></span>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="form-floating">
                        <input asp-for="AirPortRequest.CompanyName" class="form-control" placeholder=" " required />
                        <label asp-for="AirPortRequest.CompanyName"></label>
                        <span asp-validation-for="AirPortRequest.CompanyName" class="text-danger"></span>
                    </div>
                </div>

                <!-- Row 4 -->
                <div class="col-md-6">
                    <div class="form-floating">
                        <input asp-for="AirPortRequest.EntryExitPoints" class="form-control" placeholder=" " required />
                        <label asp-for="AirPortRequest.EntryExitPoints"></label>
                        <span asp-validation-for="AirPortRequest.EntryExitPoints" class="text-danger"></span>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="form-floating">
                        <select asp-for="AirPortRequest.AircraftType" class="form-select" required>
                            <option value="">Select Aircraft Type</option> <!-- Translated -->
                            <option value="Commercial">Commercial Aircraft</option> <!-- Translated -->
                            <option value="Private">Private Aircraft</option> <!-- Translated -->
                            <option value="Cargo">Cargo Aircraft</option> <!-- Translated -->
                            <option value="Military">Military Aircraft</option> <!-- Translated -->
                        </select>
                        <label asp-for="AirPortRequest.AircraftType"></label>
                        <span asp-validation-for="AirPortRequest.AircraftType" class="text-danger"></span>
                    </div>
                </div>

                <!-- Row 5 -->
                <div class="col-md-6">
                    <div class="form-floating">
                        <input asp-for="AirPortRequest.AircraftRegistration" class="form-control" placeholder=" " required />
                        <label asp-for="AirPortRequest.AircraftRegistration"></label>
                        <span asp-validation-for="AirPortRequest.AircraftRegistration" class="text-danger"></span>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="form-floating">
                        <input asp-for="AirPortRequest.CallSign" class="form-control" placeholder=" " required />
                        <label asp-for="AirPortRequest.CallSign"></label>
                        <span asp-validation-for="AirPortRequest.CallSign" class="text-danger"></span>
                    </div>
                </div>

                <!-- Row 6 -->
                <div class="col-md-6">
                    <div class="form-floating">
                        <input asp-for="AirPortRequest.FlightPath" class="form-control" placeholder=" " required />
                        <label asp-for="AirPortRequest.FlightPath"></label>
                        <span asp-validation-for="AirPortRequest.FlightPath" class="text-danger"></span>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="form-floating">
                        <input asp-for="AirPortRequest.LandingTakeoffTime" class="form-control" placeholder=" " required />
                        <label asp-for="AirPortRequest.LandingTakeoffTime"></label>
                        <span asp-validation-for="AirPortRequest.LandingTakeoffTime" class="text-danger"></span>
                    </div>
                </div>

                <!-- Row 7 -->
                <div class="col-md-6">
                    <div class="form-floating">
                        <select asp-for="AirPortRequest.FlightPurpose" class="form-select" required>
                            <option value="">Select Flight Purpose</option> <!-- Translated -->
                            <option value="Commercial">Commercial Flight</option> <!-- Translated -->
                            <option value="Private">Private Flight</option> <!-- Translated -->
                            <option value="Cargo">Cargo Shipment</option> <!-- Translated -->
                            <option value="Military">Military Flight</option> <!-- Translated -->
                        </select>
                        <label asp-for="AirPortRequest.FlightPurpose"></label>
                        <span asp-validation-for="AirPortRequest.FlightPurpose" class="text-danger"></span>
                    </div>
                </div>

                <!-- Row 8 - Crew Information -->
                <div class="col-md-6">
                    <div class="form-floating">
                        <input asp-for="AirPortRequest.PilotName" class="form-control" placeholder=" " />
                        <label asp-for="AirPortRequest.PilotName">Pilot Name</label> <!-- Translated -->
                        <span asp-validation-for="AirPortRequest.PilotName" class="text-danger"></span>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="form-floating">
                        <input asp-for="AirPortRequest.FlightNumber" class="form-control" placeholder=" " />
                        <label asp-for="AirPortRequest.FlightNumber">Flight Number</label> <!-- Translated -->
                        <span asp-validation-for="AirPortRequest.FlightNumber" class="text-danger"></span>
                    </div>
                </div>

                <!-- Row 9 - Entry and Exit Points -->
                <div class="col-md-6">
                    <div class="form-floating">
                        <input asp-for="AirPortRequest.EntryPoint" class="form-control" placeholder=" " />
                        <label asp-for="AirPortRequest.EntryPoint">Entry Point</label> <!-- Translated -->
                        <span asp-validation-for="AirPortRequest.EntryPoint" class="text-danger"></span>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="form-floating">
                        <input asp-for="AirPortRequest.ExitPoint" class="form-control" placeholder=" " />
                        <label asp-for="AirPortRequest.ExitPoint">Exit Point</label> <!-- Translated -->
                        <span asp-validation-for="AirPortRequest.ExitPoint" class="text-danger"></span>
                    </div>
                </div>

                <!-- Row 10 - Estimated Times -->
                <div class="col-md-6">
                    <div class="form-floating">
                        <input asp-for="AirPortRequest.EstimatedEntryTime" class="form-control" type="datetime-local" placeholder=" " />
                        <label asp-for="AirPortRequest.EstimatedEntryTime">Estimated Entry Time</label> <!-- Translated -->
                        <span asp-validation-for="AirPortRequest.EstimatedEntryTime" class="text-danger"></span>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="form-floating">
                        <input asp-for="AirPortRequest.EstimatedExitTime" class="form-control" type="datetime-local" placeholder=" " />
                        <label asp-for="AirPortRequest.EstimatedExitTime">Estimated Exit Time</label> <!-- Translated -->
                        <span asp-validation-for="AirPortRequest.EstimatedExitTime" class="text-danger"></span>
                    </div>
                </div>

                <!-- Row 11 - Cargo and Crew Information -->
                <div class="col-md-6">
                    <div class="form-floating">
                        <input asp-for="AirPortRequest.CargoDetails" class="form-control" placeholder=" " />
                        <label asp-for="AirPortRequest.CargoDetails">Cargo Details</label> <!-- Translated -->
                        <span asp-validation-for="AirPortRequest.CargoDetails" class="text-danger"></span>
                    </div>
                </div>

                <div class="col-md-3">
                    <div class="form-floating">
                        <input asp-for="AirPortRequest.CrewCount" class="form-control" type="number" min="0" placeholder=" " />
                        <label asp-for="AirPortRequest.CrewCount">Crew Count</label> <!-- Translated -->
                        <span asp-validation-for="AirPortRequest.CrewCount" class="text-danger"></span>
                    </div>
                </div>

                <div class="col-md-9">
                    <div class="form-floating">
                        <input asp-for="AirPortRequest.CrewNationalities" class="form-control" placeholder=" " />
                        <label asp-for="AirPortRequest.CrewNationalities">Crew Nationalities</label> <!-- Translated -->
                        <span asp-validation-for="AirPortRequest.CrewNationalities" class="text-danger"></span>
                    </div>
                </div>

                <!-- Notes Field -->
                <div class="col-12">
                    <div class="form-floating">
                        <textarea asp-for="AirPortRequest.Notes" class="form-control" placeholder=" " style="height: 100px"></textarea>
                        <label asp-for="AirPortRequest.Notes"></label>
                        <span asp-validation-for="AirPortRequest.Notes" class="text-danger"></span>
                    </div>
                </div>

                <div id="attachmentsContainer" class="col-12 mt-3"></div> <!-- Added col-12 and mt-3 for spacing -->

                <div class="col-12">
                    <!-- Wrapped button in col-12 for proper grid alignment -->
                    <button type="button" class="btn btn-primary mt-2" onclick="addAttachmentRow()">
                        <i class="fas fa-paperclip me-1"></i>Add Attachment <!-- Translated & Icon added -->
                    </button>
                </div>
            </div>

            <!-- Image Preview Box (No text to translate here, alt text already generic) -->
            <div id="imagePreview" class="text-center my-3" style="display: none;">
                <img id="previewImage" src="" alt="Preview" class="img-thumbnail" style="max-width: 100%; max-height: 300px;" />
            </div>

            <!-- Submit Buttons -->
            <div class="d-flex justify-content-center gap-3 mt-5">
                <button type="submit" class="btn btn-primary btn-lg px-5">
                    <i class="fas fa-save me-2"></i>Save Request <!-- Translated -->
                </button>
                <button type="reset" class="btn btn-outline-secondary btn-lg px-5">
                    <i class="fas fa-undo me-2"></i>Reset <!-- Translated -->
                </button>
            </div>
        </form>
    </div>
</div>

@section Styles {
    <style>
        .card {
            border-radius: 0.625rem; /* 10px */
            max-width: 75rem; /* 1200px */
            margin: 0 auto;
        }
        /* Styles for LTR floating labels (Bootstrap 5 default for LTR) */
        .form-floating > label {
            /* Default Bootstrap 5 LTR behavior, no specific override needed unless RTL was forced previously */
        }

        .form-control, .form-select {
            /* padding: 1rem 0.75rem 0.25rem 0.75rem; /* Adjusted padding for standard height */
            /* height: calc(3.5rem + 2px); /* This makes inputs quite tall, standard is usually less */
        }

        .text-danger {
            font-size: 0.85rem;
        }
        /* Added some styles for attachment rows if needed */
        #attachmentsContainer .row {
            padding: 0.5rem;
            border: 1px solid #dee2e6; /* Light border for each attachment row */
            border-radius: 0.25rem;
            background-color: #f8f9fa; /* Light background */
        }
    </style>
}
@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        // JavaScript code remains the same, but labels inside it will be translated.
        let selectedFiles = []; // This variable seems unused in the provided attachment logic
        let attachmentIndex = 0;

        // The `fileInput`, `fileList` related DOMContentLoaded logic seems to be for a different uploader
        // I'll keep the addAttachmentRow logic as it is, assuming it's the one in use.
        // If 'fileInput' and 'fileList' are part of a different, now unused, uploader, they can be removed.

        document.addEventListener('DOMContentLoaded', function () {
            // This section seems to be for a different file uploader (id="fileInput", id="fileList")
            // than the one dynamically added by addAttachmentRow.
            // If it's not used, it can be removed to avoid confusion.
            const fileInput = document.getElementById('fileInput'); // This ID is not in the HTML for attachments
            const fileList = document.getElementById('fileList');   // This ID is not in the HTML
            const imagePreview = document.getElementById('imagePreview');
            const previewImage = document.getElementById('previewImage');

            if (fileInput) { // Check if the element exists before adding event listener
                fileInput.addEventListener('change', (event) => {
                    const files = Array.from(event.target.files);
                    selectedFiles = [...selectedFiles, ...files]; // 'selectedFiles' is not used by 'addAttachmentRow'
                    renderFileList();
                });
            }

            function renderFileList() { // This function is tied to the 'fileInput' & 'fileList' uploader
                if (!fileList) return; // Guard clause
                fileList.innerHTML = '';

                selectedFiles.forEach((file, index) => {
                    const fileItem = document.createElement('div');
                    fileItem.className = 'd-flex align-items-center justify-content-between mb-2 border p-2 rounded bg-light';

                    const fileName = document.createElement('span');
                    fileName.textContent = file.name;
                    fileName.style.cursor = 'pointer';
                    fileName.classList.add('me-2', 'text-primary', 'file-link');
                    fileName.onclick = () => previewFile(file);

                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'btn btn-sm btn-danger';
                    deleteBtn.textContent = '✖';
                    deleteBtn.onclick = () => {
                        selectedFiles.splice(index, 1);
                        renderFileList();
                    };

                    fileItem.appendChild(fileName);
                    fileItem.appendChild(deleteBtn);
                    fileList.appendChild(fileItem);
                });

                if (fileInput) { // Guard clause
                    const dataTransfer = new DataTransfer();
                    selectedFiles.forEach(f => dataTransfer.items.add(f));
                    fileInput.files = dataTransfer.files;
                }
            }

            function previewFile(file) { // This function is tied to the 'fileInput' & 'fileList' uploader
                if (!imagePreview || !previewImage) return; // Guard clauses

                if (file && file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        previewImage.src = e.target.result;
                        imagePreview.style.display = 'block';
                    };
                    reader.readAsDataURL(file);
                } else {
                    imagePreview.style.display = 'none';
                    previewImage.src = '';
                }
            }
        });

        function addAttachmentRow() {
            const container = document.getElementById('attachmentsContainer');

            const row = document.createElement('div');
            row.className = 'row align-items-end mb-3'; // Bootstrap classes for alignment and margin
            row.dataset.index = attachmentIndex;

            const fileTypeCol = document.createElement('div');
            fileTypeCol.className = 'col-md-5';
            fileTypeCol.innerHTML = `
                        <label class="form-label">File Type</label> <!-- Translated -->
                        <select name="FileTypes[${attachmentIndex}].FileTypeId" class="form-select" required>
                            <option value="">Select File Type</option> <!-- Translated -->
                            ${getFileTypeOptions()}
                        </select>
                    `;

            const fileInputCol = document.createElement('div');
            fileInputCol.className = 'col-md-5'; // Adjusted for a 2-col delete button
            fileInputCol.innerHTML = `
                        <label class="form-label">Attachment</label> <!-- Translated -->
                        <input type="file" name="FileTypes[${attachmentIndex}].File" class="form-control" required />
                    `;

            const deleteCol = document.createElement('div');
            deleteCol.className = 'col-md-2 d-flex align-items-end pb-1'; // Align button with bottom of inputs
            deleteCol.innerHTML = `
                        <button type="button" class="btn btn-danger w-100" onclick="removeAttachmentRow(this)">
                            <i class="fas fa-trash-alt"></i> <!-- Icon Added -->
                        </button>
                    `;

            row.appendChild(fileTypeCol);
            row.appendChild(fileInputCol);
            row.appendChild(deleteCol);

            container.appendChild(row);
            attachmentIndex++;
        }

        function removeAttachmentRow(button) {
            const row = button.closest('.row');
            row.remove();
            // Optionally, re-index if needed, but usually not necessary if server handles gaps.
        }

        function getFileTypeOptions() {
            return `
        @if (ViewBag.FileTypes != null)
        {
            foreach (var type in ViewBag.FileTypes)
            {
                <text><option value="@type.Id">@type.TypeName</option></text>
            }
        }
                    `;
        }
    </script>
}