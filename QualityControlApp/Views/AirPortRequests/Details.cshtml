@model QualityControlApp.Models.Entities.AirPortRequest

@{
    ViewData["Title"] = "تفاصيل الطلب";
}


<div class="card shadow-lg mt-10">
    <div class="card-header bg-warning text-dark py-3">
        <div class="d-flex justify-content-between align-items-center flex-wrap">
            <h2 class="card-title mb-0 text-center">
                <i class="fas fa-edit me-2"></i>@ViewData["Title"]
            </h2>

            <div>
                <label class="form-label fw-bold me-2 mb-0">حالة الطلب:</label>
                @{
                    string statusClass = Model.RequestStatus switch
                    {
                        "Approved" => "text-success",
                        "Pending" => "text-warning",
                        "Rejected" => "text-danger",
                        _ => "text-secondary"
                    };

                    string statusText = Model.RequestStatus switch
                    {
                        "Approved" => "تمت الموافقة",
                        "Pending" => "قيد الانتظار",
                        "Rejected" => "مرفوض",
                        _ => "غير معروف"
                    };
                }
                <button class="fw-bold @statusClass fs-5">@statusText</button>
            </div>
        </div>
    </div>

    <div class="card-body p-4">
        <div class="row g-3">
            @* عرض الحقول *@
            <div class="col-md-6">
                <label class="form-label fw-bold">الإدارة</label>
                <div class="form-control-plaintext">@Model.Department</div>
            </div>

            <div class="col-md-6">
                <label class="form-label fw-bold">وقت الإدخال</label>
                <div class="form-control-plaintext">@Model.EntryTime</div>
            </div>

            <div class="col-md-6">
                <label class="form-label fw-bold">وقت الطلب</label>
                <div class="form-control-plaintext">@Model.RequestTime</div>
            </div>

            <div class="col-md-6">
                <label class="form-label fw-bold">البريد الإلكتروني</label>
                <div class="form-control-plaintext">@Model.Email</div>
            </div>

            <div class="col-md-6">
                <label class="form-label fw-bold">اسم المرسل</label>
                <div class="form-control-plaintext">@Model.SenderName</div>
            </div>

            <div class="col-md-6">
                <label class="form-label fw-bold">اسم الشركة</label>
                <div class="form-control-plaintext">@Model.CompanyName</div>
            </div>

            <div class="col-md-6">
                <label class="form-label fw-bold">تاريخ الرحلة</label>
                <div class="form-control-plaintext">@Model.FlightDate.ToString("yyyy-MM-dd")</div>
            </div>

            <div class="col-md-6">
                <label class="form-label fw-bold">نوع الطائرة</label>
                <div class="form-control-plaintext">@Model.AircraftType</div>
            </div>

            <div class="col-md-6">
                <label class="form-label fw-bold">تسجيل الطائرة</label>
                <div class="form-control-plaintext">@Model.AircraftRegistration</div>
            </div>

            <div class="col-md-6">
                <label class="form-label fw-bold">نداء الرحلة</label>
                <div class="form-control-plaintext">@Model.CallSign</div>
            </div>

            <div class="col-md-6">
                <label class="form-label fw-bold">مسار الرحلة</label>
                <div class="form-control-plaintext">@Model.FlightPath</div>
            </div>

            <div class="col-md-6">
                <label class="form-label fw-bold">وقت الهبوط/الإقلاع</label>
                <div class="form-control-plaintext">@Model.LandingTakeoffTime</div>
            </div>

            <div class="col-md-6">
                <label class="form-label fw-bold">غرض الرحلة</label>
                <div class="form-control-plaintext">@Model.FlightPurpose</div>
            </div>

            <div class="col-md-6">
                <label class="form-label fw-bold">نقاط الدخول/الخروج</label>
                <div class="form-control-plaintext">@Model.EntryExitPoints</div>
            </div>


            <!-- إضافة الحقول الجديدة -->
            <div class="col-md-6">
                <label class="form-label fw-bold">اسم الطيار</label>
                <div class="form-control-plaintext">@Model.PilotName</div>
            </div>

            <div class="col-md-6">
                <label class="form-label fw-bold">رقم الرحلة</label>
                <div class="form-control-plaintext">@Model.FlightNumber</div>
            </div>

            <div class="col-md-6">
                <label class="form-label fw-bold">نقطة الدخول</label>
                <div class="form-control-plaintext">@Model.EntryPoint</div>
            </div>

            <div class="col-md-6">
                <label class="form-label fw-bold">نقطة الخروج</label>
                <div class="form-control-plaintext">@Model.ExitPoint</div>
            </div>

            <div class="col-md-6">
                <label class="form-label fw-bold">وقت الدخول المتوقع</label>
                <div class="form-control-plaintext">@Model.EstimatedEntryTime?.ToString("yyyy-MM-dd HH:mm")</div>
            </div>

            <div class="col-md-6">
                <label class="form-label fw-bold">وقت الخروج المتوقع</label>
                <div class="form-control-plaintext">@Model.EstimatedExitTime?.ToString("yyyy-MM-dd HH:mm")</div>
            </div>

            <div class="col-md-6">
                <label class="form-label fw-bold">تفاصيل الشحنة</label>
                <div class="form-control-plaintext">@Model.CargoDetails</div>
            </div>

            <div class="col-md-6">
                <label class="form-label fw-bold">عدد أفراد الطاقم</label>
                <div class="form-control-plaintext">@Model.CrewCount</div>
            </div>

            <div class="col-md-6">
                <label class="form-label fw-bold">جنسيات الطاقم</label>
                <div class="form-control-plaintext">@Model.CrewNationalities</div>
            </div>


            <div class="col-12">
                <label class="form-label fw-bold">ملاحظات</label>
                <div class="form-control-plaintext">@Model.Notes</div>
            </div>

            @* المرفقات *@
            @* المرفقات *@
            @if (Model.RequestFiles != null && Model.RequestFiles.Any())
            {
                <div class="col-12 mt-4">
                    <h5 class="fw-bold">المرفقات:</h5>
                    <ul class="list-group">
                        @foreach (var file in Model.RequestFiles)
                        {
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <a href="@Url.Content("~/pictures/requestfiles/" + file.FileName)" target="_blank">
                                    <i class="bi bi-file-earmark-pdf"></i> @file.FileName
                                </a>

                            </li>
                        }
                    </ul>
                </div>
            }


        </div>
        <div class="d-flex justify-content-center gap-3 mt-5">
            <form asp-action="Delete" asp-controller="AirPortRequests" method="post" onsubmit="return confirm('هل أنت متأكد من حذف هذا الطلب؟');">
                <input type="hidden" name="id" value="@Model.Id" />
                <button type="submit" class="btn btn-danger btn-lg px-4">
                    <i class="fas fa-trash-alt me-2"></i>حذف الطلب
                </button>
            </form>

            <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-warning btn-lg px-4">
                <i class="fas fa-edit me-2"></i>تعديل الطلب
            </a>

            <button onclick="window.print()" class="btn btn-primary btn-lg px-4">
                <i class="fas fa-print me-2"></i>طباعة
            </button>

        
        </div>

    </div>
</div>

<div class="d-flex justify-content-center gap-3 mt-5">
   

    <a asp-action="Index" class="btn btn-outline-secondary btn-lg px-4">
        <i class="fas fa-arrow-left me-2"></i>رجوع
    </a>
</div>


@section Scripts {
    <partial name="_ValidationScriptsPartial" />


    <script>
        const fileInput = document.querySelector('input[name="files"]');
        const fileList = document.getElementById('fileList');
        const previewImg = document.getElementById('previewImg');
        const imagePreview = document.getElementById('imagePreview');

        let filesArray = [];

        fileInput.addEventListener('change', function () {
            filesArray = Array.from(this.files);
            updateFileList();
        });

        function updateFileList() {
            fileList.innerHTML = '';
            filesArray.forEach((file, index) => {
                const li = document.createElement('li');
                li.className = 'list-group-item d-flex justify-content-between align-items-center';

                const nameLink = document.createElement('a');
                nameLink.href = '#';
                nameLink.textContent = file.name;
                nameLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        previewImg.src = e.target.result;
                        imagePreview.classList.remove('d-none');
                    };
                    reader.readAsDataURL(file);
                });

                const removeBtn = document.createElement('button');
                removeBtn.className = 'btn btn-sm btn-danger';
                removeBtn.innerHTML = '❌';
                removeBtn.addEventListener('click', () => {
                    filesArray.splice(index, 1);
                    updateFileList();
                    if (filesArray.length === 0) {
                        imagePreview.classList.add('d-none');
                    }
                });

                li.appendChild(nameLink);
                li.appendChild(removeBtn);
                fileList.appendChild(li);
            });

            // تحديث ملفات الـ input
            const dataTransfer = new DataTransfer();
            filesArray.forEach(f => dataTransfer.items.add(f));
            fileInput.files = dataTransfer.files;



        }
    </script>

}
