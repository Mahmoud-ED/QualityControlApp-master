@using Newtonsoft.Json
@using QualityControlApp.Models.Entities
@using QualityControlApp.ViewModels
@model RepUserCompanyQuestionVM
@{
    Layout = "_LayoutReport";
}
<!DOCTYPE html>
<html lang="en" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>تقرير  شركة</title>
    <style>

        html, body {
        font-family: Arial, sans-serif;
        font-size: 1em;
        margin-top: 50px;
        margin-left: 30px;
        margin-right: 30px;
        height: 100%;


        }

        body {
        overflow-x: hidden; /* Prevent horizontal scroll on the body */
        }



        table {
        width: 100%;
        border-collapse: collapse;
        /*  margin: 20px 0; */
        }

        th, td {
        padding: 12px;
        text-align: right;
        border: 1px solid #ddd;
        }

        th {
        background-color: #ddd;
        }

        tr:nth-child(even) {
        background-color: #f2f2f2;
        }

        .header table{
        width: 100%;
        border-collapse: collapse;
        }
        .header  table th{
        text-align:center;
        background-color:ghostwhite;
        border: 0px ;
        }

        .header {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }

        .header-table {
            width: 100%;
            text-align: left;
            border-collapse: collapse;
        }

        .header-title {
            font-weight: bold;
            color: #343a40;
            padding-right: 20px;
        }

        .header-date {
            text-align: right;
            color: #6c757d;
        }

        .header h4 {
            margin: 0;
        }

    </style>

</head>
<body>
    <div style="text-align: center;">
        <h2>
            Calculation of Organizational Safety.
            Performance Level
        </h2>
    </div>
    <br />
    <br />
    <div >
        <div class="header">
            <table class="header-table">
                <tr>
                    <th class="header-title">
                        <h4>@Model.CompanyName</h4>
                    </th>
                    <th class="header-date">
                        <h4>@Model.CreateDate.ToString()</h4>
                    </th>
                </tr>
            </table>
        </div>

       

        <br />
        <br />
        @{
            int i = 0;
            foreach (var CatType in Model.lstQuestionCategoryType)
            {
                // تصفية الأسئلة حسب التصنيف الحالي
                var filteredQuestions = Model.lstCompanyQuestionContent.Where(s => s.Question.QuestionType.QuestionCategoryTypeId == CatType.Id).ToList();

                // عرض اسم التصنيف
                <h4>@CatType.CategoryName</h4>

                // تصنيف الأسئلة حسب نوع السؤال
                var groupedByType = filteredQuestions.GroupBy(s => s.Question.QuestionType.TypeName);

                foreach (var questionTypeGroup in groupedByType)
                {
                    // حساب مجموع الدرجات لهذا النوع من الأسئلة
                    var totalScore = questionTypeGroup.Sum(s => s.Score);
                    var maxScore = questionTypeGroup.Sum(s => s.Question.MaxGrid);

                    // عرض اسم نوع السؤال
                    <h5>@questionTypeGroup.Key</h5>
                    <p>مجموع الدرجات: @totalScore من أصل @maxScore</p>

                    <!-- جدول للأسئلة من هذا النوع -->
                    <table class="table">
                        <thead>
                            <tr>
                                <th>رقم</th>
                                <th>السؤال</th>
                                <th>الدرجة</th>
                                <th>سقف الدرجة</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in questionTypeGroup)
                            {
                                i++;
                                <tr>
                                    <td>@i</td>
                                    <td>@item.Question.Content</td>
                                    <td>@item.Score</td>
                                    <td>@item.Question.MaxGrid</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                    <br />
                }
            }
        }


        <br />

    </div>
   
</body>
</html>

 

